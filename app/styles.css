:root{
  --base-bg:#0b1020; --pane:#101a2eaa; --fg:#eaf0ff;
  --accent:#66aaff; --glow:rgba(102,170,255,.55);
  --beat:.3;
  --glowAlpha:.85; /* JSから調整（Glow無効=0）*/
}
html,body{margin:0;height:100%;background:var(--base-bg);color:var(--fg);font-family:system-ui,Segoe UI,Meiryo,Roboto,Arial;}
#bg{position:fixed;inset:0;z-index:-1;filter:saturate(1.05) brightness(1.03)}

.layout{display:grid;grid-template-columns:360px 1fr;gap:12px;padding:12px}
@media (max-width:1100px){ .layout{grid-template-columns:1fr} }

.sidebar{background:#0f1830;border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:10px}
.tools{display:flex;flex-direction:column;gap:8px}
.tools .btn{padding:7px 10px}
#search{padding:8px;border-radius:10px;border:1px solid #234;background:#0b1428;color:var(--fg)}
.panel{background:#0b1428;border:1px solid #1c2b4a;border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px}
.panel-title{font-weight:700;opacity:.9}
.inline{display:flex;align-items:center;gap:8px}
#plist{list-style:none;margin:0;padding:0;overflow:auto;max-height:calc(100vh - 920px)}
#plist li{padding:8px;border-radius:8px;cursor:pointer}
#plist li:hover{background:#16223a}
#plist li.active{background:#1a2744;border:1px solid #2b4770}

.stage{display:flex;flex-direction:column;gap:12px}
.titlebar{padding:6px 10px;background:var(--pane);border-radius:12px;display:flex;align-items:center;justify-content:space-between}
.titlebar h1{margin:0;font-size:16px;letter-spacing:.2px}
.titlebar-right{display:flex;gap:8px}

#videoWrap{display:flex;flex-direction:column;gap:10px}
#mpv-slot{position:relative;width:100%;aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden;box-shadow:inset 0 0 0 1px #0b1428}
#mpv-slot::after{
  content:""; position:absolute; inset:-1.5px; border-radius:16px;
  background: conic-gradient(from 0deg at 50% 50%, transparent 0 40%, var(--accent) 55%, transparent 70% 100%);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  padding:1.5px;
  animation:ringspin 4.5s linear infinite;
  /* Glow可変（--glowAlpha 0で無効） */
  opacity: calc(var(--glowAlpha,1) * (.22 + var(--beat, .3)*.45));
  pointer-events:none;
}
@keyframes ringspin{to{transform:rotate(360deg)}}

#player{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000}
#videoSpec{position:absolute;inset:0;pointer-events:none;opacity:.95;transition:opacity .25s ease}
.spinner{position:absolute;left:50%;top:50%;width:42px;height:42px;margin:-21px 0 0 -21px;border-radius:50%;
  border:3px solid rgba(255,255,255,.15);border-top-color:var(--accent);animation:spin 0.8s linear infinite;filter:drop-shadow(0 0 8px var(--glow))}
.spinner.hidden{display:none}
@keyframes spin{to{transform:rotate(360deg)}}

/* Controls */
.controls{
  background:#0f1830cc;border:1px solid #1c2b4a;border-radius:12px;padding:8px;
  display:grid;gap:8px;box-shadow:0 10px 24px -14px rgba(0,0,0,.6);animation:controlsIn .35s ease; z-index:10;
}
@keyframes controlsIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.controls .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.controls .row.left{justify-content:flex-start}
.controls .row.mid{justify-content:center;gap:10px}
.controls .row.right{justify-content:flex-end;gap:10px}

#seekWrap{position:relative;width:min(900px,76vw);height:44px;display:grid;align-items:center;margin:0 auto}
#seek{width:100%;position:relative;z-index:2}
#seekWave{position:absolute;left:0;right:0;top:10px;height:22px;border-radius:8px;background:#0b1428;z-index:1;opacity:.95}
#markers{position:absolute;left:0;right:0;top:6px;height:32px;pointer-events:none;z-index:3}
#markers .m{position:absolute;top:0;width:2px;height:32px;background:var(--accent);box-shadow:0 0 8px var(--glow);transform:translateX(-1px)}
#markers .m:hover{filter:brightness(1.2)}
#curTime,#durTime{font-variant-numeric:tabular-nums;opacity:.9}

.btn{padding:7px 10px;border-radius:10px;border:1px solid #2b4770;cursor:pointer;background:#16223a;color:var(--fg);
  transition:transform .12s ease, box-shadow .2s ease, background .2s ease}
.btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px -8px var(--glow)}
.btn.primary{background:linear-gradient(180deg,#1b2c4e,#16223a);border-color:#3b5ba0}
.btn.ghost{background:transparent;border-color:#2b3d65}

.speed-presets .btn{padding:6px 8px}

#spectrum{width:100%;height:220px;background:linear-gradient(180deg,#16223a,#0b1020);border-radius:12px}

/* EQ */
.eq{display:grid; grid-template-columns:repeat(10,1fr); gap:10px; margin-top:6px; align-items:end;}
.eqcol{position:relative; height:168px; padding-top:6px; overflow:hidden; display:flex; flex-direction:column; justify-content:flex-end; align-items:center; gap:6px; font-size:12px; opacity:.9;}
.eqcol::after{ content:attr(data-f) "Hz"; }
.eqcol .eq-slider{-webkit-appearance:none; appearance:none; background:transparent; writing-mode:vertical-rl; direction:rtl; block-size:132px; inline-size:30px; margin:0 auto;}
.eqcol .eq-slider::-webkit-slider-runnable-track{ width:10px; height:100%; background:linear-gradient(180deg,#233a66,#0b1428); border:1px solid #2b4770; border-radius:8px;}
.eqcol .eq-slider::-moz-range-track{ width:10px; height:100%; background:linear-gradient(180deg,#233a66,#0b1428); border:1px solid #2b4770; border-radius:8px;}
.eqcol .eq-slider::-webkit-slider-thumb{-webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); box-shadow:0 0 8px var(--glow); margin:0;}
.eqcol .eq-slider::-moz-range-thumb{ width:16px; height:16px; border-radius:50%; background:var(--accent); box-shadow:0 0 8px var(--glow); border:none; }

/* Thumb preview */
.thumb{position:absolute;bottom:52px;left:50%;transform:translateX(-50%);background:#0b1428;border:1px solid #1c2b4a;border-radius:10px;padding:6px;display:grid;gap:4px;box-shadow:0 12px 24px -12px rgba(0,0,0,.6)}
.thumb.hidden{display:none}
.thumb canvas{width:240px;height:135px;border-radius:6px;background:#000}
.thumb .thumb-time{font-size:12px;opacity:.9;text-align:center}

/* Toast & Help */
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0f1830;border:1px solid #1c2b4a;border-radius:10px;padding:8px 12px;opacity:0;pointer-events:none;transition:.3s}
.toast.show{opacity:1}
.help{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.55);z-index:999}
.help.hidden{display:none}
.help h2{margin-top:0}
.help ul{margin:0 0 12px 16px}

/* Gate */
.gate{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.65);z-index:2000}
.gate.hidden{display:none}
.gate-card{width:min(560px,92vw);background:#0f1830;border:1px solid #2b4770;border-radius:14px;padding:20px;box-shadow:0 18px 40px -20px rgba(0,0,0,.7)}
.gate-title{font-size:20px;font-weight:800;margin-bottom:6px}
.gate-hint{opacity:.8;font-size:12px;margin:10px 0 0}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:grid;place-items:center;z-index:1200}
.modal.hidden{display:none}
.modal-card{width:min(820px,94vw);max-height:86vh;display:grid;grid-template-rows:auto 1fr auto;gap:0;background:#0f1830;border:1px solid #2b4770;border-radius:14px;box-shadow:0 18px 40px -20px rgba(0,0,0,.7)}
.modal-header,.modal-footer{padding:12px;border-bottom:1px solid #1c2b4a}
.modal-footer{border-top:1px solid #1c2b4a;border-bottom:none}
.modal-header{display:flex;align-items:center;justify-content:space-between}
.modal-body{padding:12px;overflow:auto}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:820px){ .grid2{grid-template-columns:1fr} }

/* Console (log overlay) */
.console{
  position:fixed; right:12px; bottom:12px; width:min(520px,92vw); max-height:46vh;
  background:#0b1428cc; border:1px solid #1c2b4a; border-radius:12px; padding:8px 10px;
  box-shadow:0 10px 24px -14px rgba(0,0,0,.6); overflow:auto; z-index:1400;
  font:12px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  white-space:pre-wrap; line-height:1.35;
}
.console.hidden{display:none}
.console b{color:#fff}
.console .ok{color:#8de48d}
.console .warn{color:#ffd48a}
.console .err{color:#ff9a9a}
